# Imagen API è°ƒè¯•æŒ‡å—

## ğŸš¨ å½“å‰é—®é¢˜æ€»ç»“

### ä¸»è¦é”™è¯¯ç±»å‹
1. **ç½‘ç»œè¿æ¥è¶…æ—¶** - 30ç§’å†…æ— å“åº”
2. **ä»£ç†è¿æ¥å¤±è´¥** - ä»£ç†æœåŠ¡å™¨ `localhost:6152` æ— æ³•è¿æ¥
3. **APIé™æµ (429)** - è¯·æ±‚é¢‘ç‡è¿‡é«˜
4. **è®¤è¯é”™è¯¯ (401/403)** - APIå¯†é’¥æ— æ•ˆæˆ–æƒé™ä¸è¶³

## ğŸ” è°ƒè¯•å·¥å…·ä½¿ç”¨

### 1. ç›´è¿æµ‹è¯•å·¥å…·
```bash
cd backend && node test-imagen-direct.js
```
- ç»•è¿‡ä»£ç†ç›´æ¥æµ‹è¯•APIè¿æ¥
- æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³å»ºè®®

### 2. ä»£ç†æµ‹è¯•å·¥å…·
```bash
cd backend && node test-imagen-debug.js
```
- æµ‹è¯•å¸¦ä»£ç†çš„APIè¿æ¥
- æ£€æŸ¥ä»£ç†é…ç½®æ˜¯å¦æ­£ç¡®

## âš™ï¸ è§£å†³æ–¹æ¡ˆ

### ç½‘ç»œè¿æ¥é—®é¢˜
1. **æ£€æŸ¥ç½‘ç»œè¿æ¥**
   ```bash
   curl -I https://generativelanguage.googleapis.com
   ```

2. **ç¦ç”¨ä»£ç†æµ‹è¯•**
   - ä¸´æ—¶æ³¨é‡Šæ‰ `.env` æ–‡ä»¶ä¸­çš„ `PROXY_URL`
   - æˆ–è®¾ç½® `PROXY_URL=`ï¼ˆç©ºå€¼ï¼‰

3. **æ£€æŸ¥APIå¯†é’¥**
   - ç¡®ä¿åœ¨ Google Cloud Console ä¸­å¯ç”¨äº† Vertex AI API
   - ç¡®ä¿å¯ç”¨äº† Imagen API
   - æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„é…é¢

### ä»£ç†é…ç½®ä¿®å¤
å¦‚æœå¿…é¡»ä½¿ç”¨ä»£ç†ï¼Œè¯·ç¡®ä¿ï¼š
```bash
# æ­£ç¡®çš„ä»£ç†æ ¼å¼
PROXY_URL=http://127.0.0.1:6152
# æˆ–
PROXY_URL=http://localhost:6152
```

### é™æµé—®é¢˜å¤„ç†
1. **é™ä½è¯·æ±‚é¢‘ç‡**
   - åœ¨å‰ç«¯æ·»åŠ è¯·æ±‚é—´éš”
   - å®ç°æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶

2. **æ£€æŸ¥é…é¢**
   - ç™»å½• Google Cloud Console
   - æŸ¥çœ‹ Vertex AI API é…é¢ä½¿ç”¨æƒ…å†µ

## ğŸ§ª æµ‹è¯•æ­¥éª¤

1. **æµ‹è¯•ç›´è¿**ï¼š
   ```bash
   node test-imagen-direct.js
   ```

2. **æ£€æŸ¥æ—¥å¿—**ï¼š
   - å¯åŠ¨åç«¯æœåŠ¡ï¼š`npm run dev`
   - æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºçš„è¯¦ç»†æ—¥å¿—

3. **å‰ç«¯æµ‹è¯•**ï¼š
   - æ‰“å¼€ http://localhost:5173/imagen
   - ä½¿ç”¨ç®€å•æç¤ºè¯æµ‹è¯•ï¼š"a red apple"
   - è§‚å¯Ÿæµè§ˆå™¨æ§åˆ¶å°å’Œç»ˆç«¯æ—¥å¿—

## ğŸ“Š æ—¥å¿—åˆ†æ

### æˆåŠŸå“åº”ç¤ºä¾‹
```
[ImagenService] Successfully generated 1 images
[ImagenRoute] Request completed successfully in 5234ms
```

### é”™è¯¯å“åº”ç¤ºä¾‹
```
âŒ APIé™æµé”™è¯¯ (429): Resource has been exhausted
ğŸ’¡ è§£å†³: ç­‰å¾…60ç§’åé‡è¯•
```

### ç½‘ç»œé”™è¯¯ç¤ºä¾‹
```
âŒ ç½‘ç»œè¿æ¥å¤±è´¥ (ETIMEDOUT): è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ä»£ç†è®¾ç½®
```

## ğŸ”§ å¿«é€Ÿä¿®å¤

### ä¸´æ—¶ç¦ç”¨ä»£ç†
```bash
# å¤‡ä»½å½“å‰é…ç½®
cp .env .env.backup

# ç¦ç”¨ä»£ç†
sed -i '' 's/PROXY_URL=.*/PROXY_URL=/' .env
```

### éªŒè¯APIå¯†é’¥
```bash
# æµ‹è¯•APIå¯†é’¥æœ‰æ•ˆæ€§
curl -H "x-goog-api-key: YOUR_API_KEY" \
     "https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict"
```

## ğŸ“‹ æ£€æŸ¥æ¸…å•

- [ ] APIå¯†é’¥å·²é…ç½®ä¸”æœ‰æ•ˆ
- [ ] Vertex AI API å·²å¯ç”¨
- [ ] Imagen API å·²å¯ç”¨
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸
- [ ] ä»£ç†é…ç½®æ­£ç¡®ï¼ˆå¦‚ä½¿ç”¨ï¼‰
- [ ] é…é¢æœªç”¨å°½
- [ ] è¯·æ±‚é¢‘ç‡åˆç†

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼š
1. æ£€æŸ¥ Google Cloud Console ä¸­çš„é”™è¯¯æ—¥å¿—
2. æŸ¥çœ‹ [Vertex AI æ–‡æ¡£](https://cloud.google.com/vertex-ai/docs)
3. è”ç³» Google Cloud æ”¯æŒ